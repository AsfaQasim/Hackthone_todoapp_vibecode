# API Contracts: Better Auth Integration

## Authentication Endpoints

### POST /api/auth/register
Register a new user with email and password

**Request:**
```json
{
  "email": "user@example.com",
  "password": "securePassword123",
  "name": "John Doe"
}
```

**Response (201 Created):**
```json
{
  "user": {
    "id": "user-123456789",
    "email": "user@example.com",
    "name": "John Doe",
    "email_verified": false
  },
  "session": {
    "id": "session-123456789",
    "expires_at": "2023-12-01T10:00:00Z"
  },
  "tokens": {
    "access_token": "eyJhbGciOiJIUzI1NiIs...",
    "refresh_token": "dGhpcyBpcyBhIHJlZnJlc2g..."
  }
}
```

**Response (400 Bad Request):**
```json
{
  "error": "Validation error",
  "details": ["Email is already taken", "Password too weak"]
}
```

### POST /api/auth/login
Log in an existing user with email and password

**Request:**
```json
{
  "email": "user@example.com",
  "password": "securePassword123"
}
```

**Response (200 OK):**
```json
{
  "user": {
    "id": "user-123456789",
    "email": "user@example.com",
    "name": "John Doe",
    "email_verified": true
  },
  "session": {
    "id": "session-123456789",
    "expires_at": "2023-12-01T10:00:00Z"
  },
  "tokens": {
    "access_token": "eyJhbGciOiJIUzI1NiIs...",
    "refresh_token": "dGhpcyBpcyBhIHJlZnJlc2g..."
  }
}
```

**Response (401 Unauthorized):**
```json
{
  "error": "Invalid credentials"
}
```

### POST /api/auth/logout
Log out the current user

**Headers:**
```
Authorization: Bearer {access_token}
```

**Response (200 OK):**
```json
{
  "message": "Successfully logged out"
}
```

### GET /api/auth/session
Get current user session information

**Headers:**
```
Authorization: Bearer {access_token}
```

**Response (200 OK):**
```json
{
  "user": {
    "id": "user-123456789",
    "email": "user@example.com",
    "name": "John Doe"
  },
  "session": {
    "id": "session-123456789",
    "expires_at": "2023-12-01T10:00:00Z"
  }
}
```

**Response (401 Unauthorized):**
```json
{
  "error": "Invalid or expired token"
}
```

### POST /api/auth/refresh
Refresh the access token using a refresh token

**Request:**
```json
{
  "refresh_token": "dGhpcyBpcyBhIHJlZnJlc2g..."
}
```

**Response (200 OK):**
```json
{
  "tokens": {
    "access_token": "eyJhbGciOiJIUzI1NiIs...",
    "refresh_token": "dGhpcyBpcyBhIG5ldyByZWZyZXNo..."
  }
}
```

**Response (401 Unauthorized):**
```json
{
  "error": "Invalid or expired refresh token"
}
```

## Protected Resource Endpoints

### GET /api/todos
Get all todos for the authenticated user

**Headers:**
```
Authorization: Bearer {access_token}
```

**Response (200 OK):**
```json
[
  {
    "id": "todo-123",
    "title": "Sample Todo",
    "description": "Sample Description",
    "completed": false,
    "user_id": "user-123456789",
    "created_at": "2023-11-01T10:00:00Z",
    "updated_at": "2023-11-01T10:00:00Z"
  }
]
```

### POST /api/todos
Create a new todo for the authenticated user

**Headers:**
```
Authorization: Bearer {access_token}
Content-Type: application/json
```

**Request:**
```json
{
  "title": "New Todo",
  "description": "Todo Description",
  "completed": false
}
```

**Response (201 Created):**
```json
{
  "id": "todo-456",
  "title": "New Todo",
  "description": "Todo Description",
  "completed": false,
  "user_id": "user-123456789",
  "created_at": "2023-11-01T10:00:00Z",
  "updated_at": "2023-11-01T10:00:00Z"
}
```

## Error Response Format
All error responses follow this format:
```json
{
  "error": "Error message",
  "code": "ERROR_CODE",
  "timestamp": "2023-11-01T10:00:00Z"
}
```

## Security Headers
All responses include appropriate security headers:
- Strict-Transport-Security
- X-Content-Type-Options
- X-Frame-Options
- X-XSS-Protection